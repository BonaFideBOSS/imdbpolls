function arrayUnique(t,e,a){return a.indexOf(t)===e}function timelapse(t){var e=new Date,a=Math.abs(e-new Date(t)),l=a,o=Math.ceil(a/1e3),r=Math.ceil(a/6e4),s=Math.round(a/36e5),n=Math.round(a/864e5),i=Math.round(a/2592e6),d=Math.round(a/31104e6);if(a=l+" milliseconds ago",o>=1&&o<60){var c=o>1?" seconds ago":" second ago";a=o+c}else if(r>=1&&r<60){c=r>1?" minutes ago":" minute ago";a=r+c}else if(s>=1&&s<24){c=s>1?" hours ago":" hour ago";a=s+c}else if(n>=1&&n<30){c=n>1?" days ago":" day ago";a=n+c}else if(i>=1&&i<12){c=i>1?" months ago":" month ago";a=i+c}else if(d>=1){c=d>1?" years ago":" year ago";a=d+c}return a}const file=new XMLHttpRequest;file.open("GET","pollData/allimdbpolls.json"),file.send(),file.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var t=JSON.parse(file.responseText),e=t.authors,a=t.polls,l=a.reduce(function(t,e){t[e.authorid]||(t[e.authorid]={author:"",polls:0,votes:0,features:0,maxvotes:0,firstpoll:new Date,lastpoll:new Date(0)}),t[e.authorid].author=e.author,t[e.authorid].polls+=1,t[e.authorid].votes+=e.votes;var a=a="yes"==e.featured.toLowerCase()?1:0;return t[e.authorid].features+=a,t[e.authorid].maxvotes<e.votes&&(t[e.authorid].maxvotes=e.votes),new Date(t[e.authorid].firstpoll)>new Date(e.date)&&(t[e.authorid].firstpoll=e.date),new Date(t[e.authorid].lastpoll)<new Date(e.date)&&(t[e.authorid].lastpoll=e.date),t},{}),o=0,r=0,s=0;for(const t in l)if(Object.hasOwnProperty.call(l,t)){const a=l[t];var n=e.find(e=>e.authorid==t).avatar;""==n&&(n="img/imdbpoll.png"),o<a.votes&&(o=a.votes,$("#author-with-most-votes img").attr("src",n),$("#author-with-most-votes .card-title").html('<a href="user#'+t+'">'+a.author+"</a>"),$("#author-with-most-votes .fs-4").html(a.votes.toLocaleString())),r<a.polls&&(r=a.polls,$("#author-with-most-polls img").attr("src",n),$("#author-with-most-polls .card-title").html('<a href="user#'+t+'">'+a.author+"</a>"),$("#author-with-most-polls .fs-4").html(a.polls.toLocaleString())),s<a.features&&(s=a.features,$("#author-with-most-features img").attr("src",n),$("#author-with-most-features .card-title").html('<a href="user#'+t+'">'+a.author+"</a>"),$("#author-with-most-features .fs-4").html(a.features.toLocaleString()))}for(var i=[],d=0;d<e.length;d++){var c=a.filter(t=>t.authorid===e[d].authorid);i.push(c[0].author)}i=i.sort(),$("#total-polls").html(t.totalpolls.toLocaleString()),$("#total-authors").html(t.totalauthors.toLocaleString()),$("#total-votes").html(t.totalvotes.toLocaleString()),$("#poll-search").on("input",function(){var t="",o="",r=[],s="",n=[],i="img/imdbpoll.png";if($(this).val().length>=2){if(r=$("#poll-search").val().toLowerCase().split(" "),"poll"==$("#search-filter").val()){for(var d=0;d<a.length;d++)r.every(t=>a[d].title.toLowerCase().includes(t))&&(n.push(a[d]),n=n.reverse());if(0!=n.length){for(d=0;d<n.length;d++)if(d<5){t="<p>Top "+(d+1)+" results</p>",o='<a href="search#p='+this.value.replaceAll(" ","+")+'">See all results</a>';var c=e.find(t=>t.authorid==n[d].authorid).avatar;""!=c&&(i=c);var u='<i class="bi bi-circle-fill text-success"></i>';"closed"==n[d].status.toLowerCase()?u='<i class="bi bi-circle-fill text-secondary"></i>':"inactive"!=n[d].status.toLowerCase()&&"deleted"!=n[d].status.toLowerCase()||(u='<i class="bi bi-circle-fill text-danger"></i>');var h="";""!=n[d].date&&(h=n[d].date),s+='<div class="card"><a class="card-body" href="'+n[d].url+'" target="_blank"><img src="'+i+'"><div><span><h6>'+n[d].title+"</h6><pre>Poll by "+n[d].author+'</pre></span><pre class="text-end">'+h+" "+u+"<br>"+n[d].votes.toLocaleString()+" votes</pre></div></a></div>"}}else s="No poll found."}else if("author"==$("#search-filter").val()){var p=0;for(const a in l)if(Object.hasOwnProperty.call(l,a)){const r=l[a];if(r.author.toLowerCase().includes($("#poll-search").val().toLowerCase())&&(p+=1,p<=5)){t="<p>Top "+p+" results</p>",o='<a href="search#a='+this.value.replaceAll(" ","+")+'">See all results</a>';c=e.find(t=>t.authorid==a).avatar;""!=c&&(i=c),s+='<div class="card"><a class="card-body" href="user#'+a+'"><img src="'+i+'"><h6>'+r.author+"</h6><pre>Polls: "+r.polls+" | Votes: "+r.votes+" | Features: "+r.features+"</pre></a></div>"}}}$("#search-result").show(),$("#search-result").html(t+s+o),0==$("#search-result").html()&&$("#search-result").html("No author found.")}else $("#search-result").hide()});var u=document.getElementById("allimdbpolls"),h=u.getElementsByTagName("tbody")[0],p=u.getElementsByTagName("caption")[0];for(d=0;d<a.length;d++)$(h).append('<tr><td></td><td nowrap><a href="'+a[d].url+'" target="_blank">'+a[d].title+'</a></td><td><a href="user#'+a[d].authorid+'">'+a[d].author+"</a></td><td>"+a[d].date+"</td><td>"+a[d].votes.toLocaleString()+"</td><td>"+a[d].type+"</td><td>"+a[d].featured+"</td><td>"+a[d].status+"</td></tr>");$(p).html("Data as of "+t.lastupdated+" ("+timelapse(t.rawdate)+")");var m=yearoptions='<option value="">All</option>';for(d=0;d<i.length;d++)m+='<option value="'+i[d]+'">'+i[d]+"</option>";for(d=2013;d<=(new Date).getFullYear();d++)yearoptions+="<option>"+d+"</option>";$("#author-list").html(m),$("#year-filter").html(yearoptions);var g=document.getElementById("leaderboard"),f=g.getElementsByTagName("tbody")[0];for(const t in l)if(Object.hasOwnProperty.call(l,t)){const a=l[t];n=e.find(e=>e.authorid==t).avatar;""==n&&(n="img/imdbpoll.png");const o=864e5;var v=Math.round(Math.abs((new Date(a.firstpoll)-new Date)/o));0==v&&(v=1),$(f).append('<tr><td></td><td nowrap><a href="user#'+t+'"><img src="'+n+'">'+a.author+"</a></td><td>"+a.polls+"</td><td>"+a.votes.toLocaleString()+"</td><td>"+a.features+"</td><td>"+a.maxvotes.toLocaleString()+"</td><td>"+Math.round(a.votes/a.polls).toLocaleString()+"</td><td>"+(a.votes/v).toFixed(2).toLocaleString()+"</td><td>"+a.firstpoll+"</td><td>"+a.lastpoll+"</td></tr>")}$(document).ready(function(){function t(){for(var t=document.querySelectorAll("#allimdbpolls tbody tr"),e=document.getElementById("allimdbpolls_length").getElementsByTagName("select")[0].value,a=$("#allimdbpolls_paginate .paginate_button.current").html().replace(",",""),l=e*a-e,o=0;o<t.length;o++)t[o].querySelectorAll("td")[0].classList.contains("dataTables_empty")||(l+=1,t[o].querySelectorAll("td")[0].innerHTML=l)}function e(){var t=s.rows({search:"applied"}).count(),e=document.querySelectorAll("#allimdbpolls tbody tr"),a=document.getElementById("allimdbpolls_length").getElementsByTagName("select")[0].value,l=$("#allimdbpolls_paginate .paginate_button.current").html().replace(",",""),o=a*l-a;o=t-o;for(var r=0;r<e.length;r++)e[r].querySelectorAll("td")[0].classList.contains("dataTables_empty")||(e[r].querySelectorAll("td")[0].innerHTML=o--)}function a(){for(var t=document.querySelectorAll("#allimdbpolls tbody tr"),e=[],a=0,l=0,o=0;o<t.length;o++)t[o].querySelectorAll("td")[0].classList.contains("dataTables_empty")||(e.push(t[o].querySelectorAll("td")[2].textContent),a+=parseInt(t[o].querySelectorAll("td")[4].textContent.replace(",","")),"yes"==t[o].querySelectorAll("td")[6].innerHTML.toLowerCase()&&(l+=1));$("#sum-authors").html(e.filter(arrayUnique).length),$("#sum-votes").html(a.toLocaleString()),$("#sum-features").html(l)}function l(){for(var t=document.querySelectorAll("#leaderboard tbody tr"),e=document.getElementById("leaderboard_length").getElementsByTagName("select")[0].value,a=$("#leaderboard_paginate .paginate_button.current").html().replace(",",""),l=e*a-e,o=0;o<t.length;o++)t[o].querySelectorAll("td")[0].classList.contains("dataTables_empty")||(l+=1,t[o].querySelectorAll("td")[0].innerHTML=l)}function o(){lbrowtotal=n.rows({search:"applied"}).count();var t=document.querySelectorAll("#leaderboard tbody tr"),e=document.getElementById("leaderboard_length").getElementsByTagName("select")[0].value,a=$("#leaderboard_paginate .paginate_button.current").html().replace(",",""),l=e*a-e;l=lbrowtotal-l;for(var o=0;o<t.length;o++)t[o].querySelectorAll("td")[0].classList.contains("dataTables_empty")||(t[o].querySelectorAll("td")[0].innerHTML=l--)}function r(){for(var t=document.querySelectorAll("#leaderboard tbody tr"),e=0,a=0,l=0,o=0,r=0,s=0,n=0;n<t.length;n++)t[n].querySelectorAll("td")[0].classList.contains("dataTables_empty")||(e+=parseInt(t[n].querySelectorAll("td")[2].textContent.replace(",","")),a+=parseInt(t[n].querySelectorAll("td")[3].textContent.replace(",","")),l+=parseInt(t[n].querySelectorAll("td")[4].textContent.replace(",","")),o+=parseInt(t[n].querySelectorAll("td")[5].textContent.replace(",","")),r+=parseInt(t[n].querySelectorAll("td")[6].textContent.replace(",","")),s+=parseInt(t[n].querySelectorAll("td")[7].textContent.replace(",","")));$("#sum-author-polls").html(e.toLocaleString()),$("#sum-author-votes").html(a.toLocaleString()),$("#sum-author-features").html(l.toLocaleString()),$("#sum-author-maxvotes").html(o.toLocaleString()),$("#sum-author-avgvotes").html(r.toLocaleString()),$("#sum-author-avgvotesdaily").html(s.toLocaleString())}var s=$(u).DataTable({order:[[4,"desc"]],lengthMenu:[[10,25,50,100,250],[10,25,50,100,250]],columnDefs:[{targets:[0],orderable:!1}]});$("#author-filter").on("change",function(){var t=$(this).val();s.columns(2).search(t).draw()}),$("#year-filter").on("change",function(){var t=$(this).val();s.columns(3).search(t).draw()}),$("#type-filter").on("change",function(){var t=$(this).val();s.columns(5).search(t).draw()}),$("#hp-filter").on("change",function(){var t=$(this).val();s.columns(6).search(t).draw()}),$("#status-filter").on("change",function(){var t=$(this).val();s.columns(7).search(t).draw()}),a(),t(),$(".custom-filter select,#allimdbpolls_length select,#author-filter").on("change",function(){a(),$("#allimdbpolls thead .sorting").hasClass("sorting_desc")?t():e()}),$("#allimdbpolls_filter input").on("input",function(){a(),$("#allimdbpolls thead .sorting").hasClass("sorting_desc")?t():e()}),$("#allimdbpolls thead .sorting,#allimdbpolls_paginate").on("click",function(){a(),$("#allimdbpolls thead .sorting").hasClass("sorting_desc")?t():e()});var n=$(g).DataTable({order:[[3,"desc"]],columnDefs:[{targets:[0,1],orderable:!1}]});$("#lbsort-1").click(function(){n.order([2,"desc"]).draw()}),$("#lbsort-2").click(function(){n.order([3,"desc"]).draw()}),$("#lbsort-3").click(function(){n.order([4,"desc"]).draw()}),l(),r(),$("#leaderboard_length select").on("change",function(){r(),$("#leaderboard thead .sorting").hasClass("sorting_desc")?l():o()}),$("#leaderboard_filter input").on("input",function(){r(),$("#leaderboard thead .sorting").hasClass("sorting_desc")?l():o()}),$("#leaderboard thead .sorting,#leaderboard_paginate").on("click",function(){r(),$("#leaderboard thead .sorting").hasClass("sorting_desc")?l():o()}),$(".data-loader.loader-one").hide(),$("main").show()})}};